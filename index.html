<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¹Ø±Ø´ âˆ â€“ HO-PU ACTIVE â€“ v6.0 [Live Sync]</title>
  <style>
    :root { 
      --bg: #050505; 
      --cyan: #00f0ff; 
      --throne: #0f0;
    }
    body, html { 
      margin: 0; 
      padding: 0; 
      width: 100%; 
      height: 100%; 
      background: var(--bg); 
      overflow: hidden; 
      font-family: 'Courier New', monospace; 
    }
    canvas { 
      display: block; 
      cursor: crosshair; 
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1;
    }
    #status { 
      position: fixed; 
      top: 10px; 
      left: 10px; 
      color: var(--throne); 
      font-size: 12px; 
      z-index: 3;
      background: rgba(0,0,0,0.7);
      padding: 5px 10px;
      border-radius: 3px;
      border-left: 2px solid var(--throne);
      pointer-events: none;
      text-shadow: 0 0 5px var(--throne);
    }
    #overlay {
      position: fixed;
      bottom: 20px;
      right: 20px;
      color: #333;
      font-size: 10px;
      z-index: 2;
      opacity: 0.3;
    }
    #top-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.9);
      border-bottom: 2px solid #0f0;
      padding: 10px;
      display: flex;
      gap: 10px;
      z-index: 10;
      box-sizing: border-box;
      direction: ltr;
    }
    #top-bar textarea {
      flex: 1;
      height: 60px;
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 8px;
      font-family: monospace;
      resize: none;
      direction: rtl;
    }
    #top-bar button {
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 0 15px;
      cursor: pointer;
      font-weight: bold;
      font-family: monospace;
      white-space: nowrap;
    }
    #top-bar button:hover {
      background: #0f0;
      color: #000;
    }
    #copy-link {
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
    }
    #copy-link:hover {
      background: #0ff;
      color: #000;
    }
    #secret-trigger {
      position: fixed;
      bottom: 10px;
      left: 10px;
      width: 20px;
      height: 20px;
      background: transparent;
      border: 1px solid #0f0;
      opacity: 0.2;
      z-index: 20;
      cursor: pointer;
    }
    #secret-trigger:hover {
      opacity: 1;
      background: #0f0;
    }
    .advanced-ui {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(0,0,0,0.95);
      padding: 15px;
      display: flex;
      gap: 10px;
      border-top: 2px solid #0f0;
      z-index: 15;
      transform: translateY(100%);
      transition: transform 0.3s;
      box-sizing: border-box;
    }
    .advanced-ui.visible {
      transform: translateY(0);
    }
    .advanced-ui button {
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 10px 15px;
      cursor: pointer;
    }
    .advanced-ui input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>

<canvas id="view"></canvas>
<div id="status">[Ø¹Ø±Ø´ âˆ â€“ Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¤Ù…Ù†...]</div>
<div id="overlay">[Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù†ØºÙ„Ù‚]</div>

<div id="top-bar">
  <textarea id="payload" placeholder="Ø§Ù†ØªØ¸Ø±... Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„Ù†ÙˆØ§Ø©..."></textarea>
  <button id="btn-update">âœ ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠ</button>
  <button id="copy-link" onclick="copyPageLink()">ğŸ”— Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
</div>

<div id="secret-trigger" title="ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©"></div>

<div class="advanced-ui" id="advanced-ui">
  <button id="btn-save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© (PNG)</button>
  <input type="file" id="file-decode" accept="image/png">
  <button onclick="document.getElementById('file-decode').click()">ğŸ“‚ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù† ØµÙˆØ±Ø©</button>
  <button id="btn-reset">âŸ² ÙØ±Ø¶ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
</div>

<script>
// --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠ (ØªÙ… Ø¶Ø¨Ø·Ù‡ Ø¹Ù„Ù‰ Gist Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ) ---
// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· RAW Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† Hash Ù„Ø¶Ù…Ø§Ù† Ø¬Ù„Ø¨ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø­Ø¯Ø«
const BASE_GIST_URL = "https://gist.githubusercontent.com/tombad8900/d76dd7549aec3ab48a1ed451c10ffb4d/raw/";

const canvas = document.getElementById('view');
const ctx = canvas.getContext('2d', { alpha: false });
const payloadInput = document.getElementById('payload');
const statusDiv = document.getElementById('status');
const advancedUI = document.getElementById('advanced-ui');
const secretTrigger = document.getElementById('secret-trigger');

const Engine = {
    textToBits: (text) => {
        const encoder = new TextEncoder();
        const bytes = encoder.encode(text);
        let bits = "";
        bytes.forEach(b => bits += b.toString(2).padStart(8, '0'));
        return bits + "00000000";
    },
    inject: (imageData, bits) => {
        const data = imageData.data;
        for (let i = 0; i < bits.length && i < data.length / 4; i++) {
            data[i * 4] = (data[i * 4] & 0xFE) | parseInt(bits[i]);
        }
        return imageData;
    },
    extract: (imageData) => {
        const data = imageData.data;
        let bits = "";
        for (let i = 0; i < data.length; i += 4) {
            bits += (data[i] & 1).toString();
        }
        let bytes = [];
        for (let i = 0; i < bits.length; i += 8) {
            let byteStr = bits.substr(i, 8);
            if (byteStr.length < 8) break;
            let byte = parseInt(byteStr, 2);
            if (byte === 0) break;
            bytes.push(byte);
        }
        if (bytes.length === 0) return "";
        try { return new TextDecoder().decode(new Uint8Array(bytes)); } catch { return ""; }
    },
    embedPayload: (payload) => {
        renderText(payload);
        let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const bits = Engine.textToBits(payload);
        imageData = Engine.inject(imageData, bits);
        ctx.putImageData(imageData, 0, 0);
        return true;
    },
    extractPayload: () => {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        return Engine.extract(imageData);
    }
};

function renderText(text) {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = '#0f0';
    let fs = 70;
    ctx.font = `bold ${fs}px 'Courier New'`;
    let lines = wrapText(text, canvas.width * 0.8);
    while (lines.length * fs * 1.5 > canvas.height * 0.6 && fs > 12) {
        fs -= 5;
        ctx.font = `bold ${fs}px 'Courier New'`;
        lines = wrapText(text, canvas.width * 0.8);
    }
    const lh = fs * 1.4;
    const totalH = lines.length * lh;
    let y = (canvas.height - totalH) / 2 + lh / 2;
    lines.forEach(line => {
        ctx.fillText(line, canvas.width / 2, y);
        y += lh;
    });
}

function wrapText(text, maxWidth) {
    if(!text) return [""];
    const lines = text.split('\n');
    let wrappedLines = [];
    lines.forEach(line => {
        const words = line.split(' ');
        let currentLine = '';
        words.forEach(word => {
            let test = currentLine + word + ' ';
            if (ctx.measureText(test).width > maxWidth) {
                wrappedLines.push(currentLine.trim());
                currentLine = word + ' ';
            } else currentLine = test;
        });
        wrappedLines.push(currentLine.trim());
    });
    return wrappedLines;
}

function updateImage() {
    const txt = payloadInput.value;
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    Engine.embedPayload(txt);
    statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ â€“ HO-PU ACTIVE] Ø§Ù„Ù†ÙˆØ§Ø© Ù…Ø³ØªÙ‚Ø±Ø©";
}

// --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø³Ø±ÙŠ (Anti-Cache System) ---
async function fetchExternalPayload() {
    statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…ØµØ¯Ø±...";
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Timestamp) Ù„Ù„Ø±Ø§Ø¨Ø· Ù„Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ Ø¬Ù„Ø¨ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø©
    const cacheBuster = "?t=" + new Date().getTime();
    const finalUrl = BASE_GIST_URL + cacheBuster;

    try {
        const response = await fetch(finalUrl, { cache: "no-store" });
        if (response.ok) {
            const text = await response.text();
            if(text && text.trim().length > 0) {
                payloadInput.value = text;
                updateImage();
                statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©";
            } else {
                statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] Ø§Ù„Ù…ØµØ¯Ø± ÙØ§Ø±ØºØŒ Ø¨Ù‚Ø§Ø¡ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ";
            }
        } else {
            statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] Ø®Ø·Ø£ ÙÙŠ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„";
        }
    } catch (err) {
        console.error(err);
        statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù†ÙˆØ§Ø© (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)";
    }
}

window.copyPageLink = function() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·";
    }).catch(() => {
        statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®";
    });
};

document.getElementById('btn-update').onclick = updateImage;
document.getElementById('btn-save').onclick = () => {
    const link = document.createElement('a');
    link.download = `THRONE_${Date.now()}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
    statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©";
};

// Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¢Ù† ÙŠÙ‚ÙˆÙ… Ø¨ÙØ±Ø¶ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Gist
document.getElementById('btn-reset').onclick = fetchExternalPayload;

document.getElementById('file-decode').onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
        const img = new Image();
        img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            const extracted = Engine.extractPayload();
            if (extracted) {
                payloadInput.value = extracted;
                statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] ØªÙ… ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±";
                renderText(extracted);
            } else { statusDiv.textContent = "[Ø¹Ø±Ø´ âˆ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"; }
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
};

secretTrigger.onclick = () => { advancedUI.classList.toggle('visible'); };
window.onresize = () => { updateImage(); };
window.onload = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    fetchExternalPayload(); // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ± Ø§Ù„ØªØ­Ù…ÙŠÙ„
};
</script>
</body>
</html>
