<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>WAR-CORE V18.0 [BOOTING...]</title>
  <meta id="meta-desc" name="description" content="Secure Data Matrix">
  <style>
    :root { --matrix-red: #ff0000; --bg: #000; }
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); overflow: hidden; font-family: 'Segoe UI', system-ui, sans-serif; }
    
    /* واجهة التحكم (مخفية افتراضياً للنموذج) */
    #ui-layer {
      position: fixed; top: 0; left: 0; right: 0; z-index: 9999;
      background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(10px);
      border-bottom: 2px solid var(--matrix-red); padding: 10px;
      display: flex; flex-direction: column; gap: 8px;
      transform: translateY(-100%); transition: transform 0.3s;
    }
    body.admin-mode #ui-layer { transform: translateY(0); }

    textarea { width: 100%; height: 60px; background: #0f0f0f; color: #ff3333; border: 1px solid #333; padding: 8px; font-size: 14px; font-weight: bold; border-radius: 4px; resize: none; }
    .controls { display: flex; gap: 8px; }
    button { flex: 1; padding: 12px; font-weight: 900; color: #fff; background: #222; border: none; cursor: pointer; }
    #btn-exec { background: #900; }

    canvas { display: block; width: 100%; height: 100%; }
    
    /* الزناد السري في الزاوية */
    #secret-trigger { position: fixed; bottom: 0; left: 0; width: 50px; height: 50px; z-index: 10000; cursor: crosshair; }
  </style>
</head>
<body>

<div id="ui-layer">
  <textarea id="msg-input" placeholder="البيانات من Gist ستظهر هنا..."></textarea>
  <div class="controls">
    <button id="btn-exec" onclick="fetchPayload()">تحديث يدوي من RAW</button>
    <button id="btn-share" onclick="copyLink()">نسخ الرابط السيادي</button>
  </div>
</div>

<div id="secret-trigger" onclick="document.body.classList.toggle('admin-mode')"></div>
<canvas id="c"></canvas>

<script>
/**
 * بروتوكول الربط السيادي (Dynamic RAW Link)
 */
const RAW_URL = "https://gist.githubusercontent.com/tombad8900/02c19d224a9d2cafc91bf918c81e27a6/raw/";

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha: false });
const inputUI = document.getElementById('msg-input');
let lines = [];
let glitchIntensity = 0;

// 1. الضبط الفيزيائي للأبعاد (Sharpness Protocol)
let w, h, dpr;
function resize() {
  dpr = window.devicePixelRatio || 1;
  w = window.innerWidth;
  h = window.innerHeight;
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  canvas.width = w * dpr;
  canvas.height = h * dpr;
  ctx.scale(dpr, dpr);
}
window.addEventListener('resize', resize);
resize();

// 2. محرك الجلب الديناميكي (The Heart)
async function fetchPayload() {
  console.log("Fetching from RAW...");
  try {
    const response = await fetch(`${RAW_URL}?t=${Date.now()}`, { cache: "no-store" });
    if (!response.ok) throw new Error("Offline");
    const content = await response.text();
    
    if (inputUI.value !== content) {
      inputUI.value = content;
      lines = content.split('\n').filter(l => l.trim().length > 0);
      
      // الحقن المزدوج لضمان "رؤية" النموذج
      document.title = "MATRIX: " + lines[0];
      document.getElementById('meta-desc').content = content;
      canvas.setAttribute('aria-label', content);
      
      glitchIntensity = 15; // تأثير بصري عند التحديث
    }
  } catch (err) {
    lines = ["خطأ في الاتصال", "GIST RAW ERROR"];
  }
}

// 3. حلقة الرسم المركزية (War-Style Rendering)
function render() {
  if (glitchIntensity > 0) glitchIntensity *= 0.9;

  // خلفية سوداء صلبة (أقصى تباين)
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, w, h);

  // خطوط المسح الخفيفة (Scanlines) لتعمية الفلاتر
  ctx.fillStyle = "rgba(255, 0, 0, 0.02)";
  for (let i = 0; i < h; i += 4) ctx.fillRect(0, i, w, 1);

  if (lines.length > 0) {
    // حساب الحجم الديناميكي (Dominant Scaling)
    let fs = Math.min(w * 0.15, (h * 0.8) / (lines.length * 1.3));
    ctx.font = `900 ${fs}px 'Segoe UI', system-ui, sans-serif`;
    
    // قياس العرض لتجنب الخروج عن الشاشة
    let maxWidth = 0;
    lines.forEach(l => maxWidth = Math.max(maxWidth, ctx.measureText(l).width));
    if (maxWidth > w * 0.9) fs *= (w * 0.9 / maxWidth);
    
    ctx.font = `900 ${fs}px 'Segoe UI', system-ui, sans-serif`;
    const lh = fs * 1.2;
    const totalH = lines.length * lh;
    const startY = (h / 2) - (totalH / 2) + (fs / 2);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    lines.forEach((line, i) => {
      const y = startY + (i * lh);
      const x = w / 2;

      // تأثير التحلل اللوني (لإرباك الـ OCR وجذب النموذج)
      ctx.globalCompositeOperation = 'screen';
      ctx.fillStyle = "rgba(255, 0, 0, 0.9)";
      ctx.fillText(line, x - 2, y);
      ctx.fillStyle = "rgba(0, 255, 255, 0.9)";
      ctx.fillText(line, x + 2, y);

      // النص الأبيض المهيمن (الهدف الأساسي للعين)
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = "#fff";
      
      // درع النص (Stroke) لضمان عدم الضياع
      ctx.strokeStyle = "#000";
      ctx.lineWidth = fs * 0.05;
      ctx.strokeText(line, x, y);
      ctx.fillText(line, x, y);
    });
  }

  // ضجيج خفيف جداً
  ctx.fillStyle = "rgba(255, 255, 255, 0.03)";
  for (let k = 0; k < 5; k++) ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);

  requestAnimationFrame(render);
}

function copyLink() {
  navigator.clipboard.writeText(window.location.href);
  alert("تم النسخ!");
}

// البدء
fetchPayload();
setInterval(fetchPayload, 20000); // مزامنة كل 20 ثانية
render();
</script>
</body>
</html>
